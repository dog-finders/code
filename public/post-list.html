<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="utf-8" />
    <title>모집글 목록 - 도그 파인더스</title>
    <link href="css/styles.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="border-end bg-white" id="sidebar-wrapper">
            <div class="sidebar-heading border-bottom bg-light">도그 파인더스</div>
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action p-3" href="index.html">홈</a>
                <a class="list-group-item list-group-item-action p-3" href="map.html">지도</a>
                <a class="list-group-item list-group-item-action p-3 active" href="post-list.html">모집글</a>
                <a class="list-group-item list-group-item-action p-3" href="mailbox.html">메일함</a>
                <a class="list-group-item list-group-item-action p-3" href="settings.html">프로필 설정</a>
                <a class="list-group-item list-group-item-action p-3" href="login.html">로그인</a>
                <a class="list-group-item list-group-item-action p-3" href="contact.html">1:1 문의</a>
            </div>
        </div>

        <!-- Page content -->
        <div id="page-content-wrapper">
            <div class="container-fluid mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>모집글 목록</h3>
                    <a href="post-create.html" class="btn btn-primary">글 작성</a>
                </div>

                <!-- 검색창 -->
                <form class="mb-3" id="searchForm">
                    <div class="input-group">
                        <input type="text" class="form-control" id="searchInput" placeholder="제목 또는 지역으로 검색" />
                        <button class="btn btn-outline-secondary" type="submit">검색</button>
                    </div>
                </form>

                <!-- 모집글 목록 -->
                <div class="list-group" id="postList">
                    <!-- 동적 데이터 삽입 위치 -->
                </div>

                <!-- 페이지네이션 (디자인만 구현) -->
                <nav aria-label="Page navigation" class="mt-4">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">이전</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">다음</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <script>
        async function loadPosts(query = '') {
            try {
                let url = '/api/groups';
                if (query.trim()) {
                    url += `?search=${encodeURIComponent(query.trim())}`;
                }

                const res = await fetch(url);
                const posts = await res.json();

                const postList = document.getElementById('postList');
                postList.innerHTML = '';

                if (posts.length === 0) {
                    postList.innerHTML = `<div class="text-muted">'${query}'(으)로 검색된 모집글이 없습니다.</div>`;
                    return;
                }

                posts.forEach(post => {
                    const a = document.createElement('a');
                    a.href = `/post-detail?id=${post.id}`; // 상세 페이지로 이동하도록 링크 변경
                    a.className = 'list-group-item list-group-item-action';
                    a.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">${post.title}</h5>
                            <small>작성자: ${post.writer || '알 수 없음'} | ${post.location}</small>
                        </div>
                        <p class="mb-1">${post.content}</p>
                        <small>${new Date(post.created_at).toLocaleDateString()}</small>
                    `;
                    postList.appendChild(a);
                });
            } catch (err) {
                console.error(err);
                alert('목록 불러오기 실패');
            }
        }

        // 초기 목록 로드
        loadPosts();

        // 검색 기능
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const query = document.getElementById('searchInput').value;
            loadPosts(query);
        });
    </script>
</body>
</html>
