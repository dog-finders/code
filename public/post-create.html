<!-- post-create.html -->
<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="utf-8" />
    <title>모집글 작성 - 도그 파인더스</title>
    <link href="/css/styles.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-text-light {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="border-end bg-white" id="sidebar-wrapper">
            <div class="sidebar-heading border-bottom bg-light">도그 파인더스</div>
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action p-3" href="index.html">홈</a>
                <a class="list-group-item list-group-item-action p-3" href="map.html">지도</a>
                <a class="list-group-item list-group-item-action p-3 active" href="post-list.html">모집글</a>
                <a class="list-group-item list-group-item-action p-3" href="mailbox.html">메일함</a>
                <a class="list-group-item list-group-item-action p-3" href="settings.html">프로필 설정</a>
                <a class="list-group-item list-group-item-action p-3" href="login.html">로그인</a>
                <a class="list-group-item list-group-item-action p-3" href="contact.html">1:1 문의</a>
            </div>
        </div>

        <!-- Page content -->
        <div id="page-content-wrapper">
            <div class="container-fluid mt-4">
                <h3>모집글 작성</h3>
                <form id="postForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">제목</label>
                        <input type="text" class="form-control" id="title" placeholder="제목을 입력하세요" required>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="sido" class="form-label">시·도</label>
                            <input type="text" class="form-control" id="sido" placeholder="예: 서울특별시" required>
                            <div class="form-text form-text-light">예시: 서울특별시</div>
                        </div>
                        <div class="col-md-4">
                            <label for="sigungu" class="form-label">시·군·구</label>
                            <input type="text" class="form-control" id="sigungu" placeholder="예: 강남구" required>
                            <div class="form-text form-text-light">예시: 강남구</div>
                        </div>
                        <div class="col-md-4">
                            <label for="dong" class="form-label">동·읍·면</label>
                            <input type="text" class="form-control" id="dong" placeholder="예: 삼성동" required>
                            <div class="form-text form-text-light">예시: 삼성동</div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="content" class="form-label">내용</label>
                        <textarea class="form-control" id="content" rows="5" placeholder="내용을 입력하세요" required></textarea>
                    </div>

                    <div class="mb-3">
                        <label for="close_at" class="form-label">모집 마감 시간</label>
                        <input type="datetime-local" class="form-control" id="close_at" required>
                    </div>

                    <button type="submit" class="btn btn-success">작성 완료</button>
                    <a href="post-list.html" class="btn btn-secondary">취소</a>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('postForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const sido = document.getElementById('sido').value;
            const sigungu = document.getElementById('sigungu').value;
            const dong = document.getElementById('dong').value;
            const content = document.getElementById('content').value;
            const close_at = document.getElementById('close_at').value;

            const location = `${sido} ${sigungu} ${dong}`;

            const body = {
                title,
                location,
                content,
                close_at
            };

            try {
                const response = await fetch('/api/groups', {  // 여기 경로 수정
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                if (response.ok) {
                    alert('모집글이 성공적으로 작성되었습니다.');
                    window.location.href = 'post-list.html';
                } else {
                    const err = await response.json();
                    alert('작성 실패: ' + (err.message || '알 수 없는 오류'));
                }
            } catch (error) {
                console.error(error);
                alert('서버 연결 오류');
            }
        });
    </script>
</body>
</html>
